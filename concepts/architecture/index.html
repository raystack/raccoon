<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-concepts/architecture">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v0.0.0-5124">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XXX",{})</script><title data-rh="true">Architecture | Raccoon</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://raystack.github.io//raccoon/concepts/architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture | Raccoon"><meta data-rh="true" name="description" content="Raccoon written in GO is a high throughput, low-latency service that provides an API to ingest streaming data from mobile apps, sites and publish it to message queues. Following message queues are currently supported:"><meta data-rh="true" property="og:description" content="Raccoon written in GO is a high throughput, low-latency service that provides an API to ingest streaming data from mobile apps, sites and publish it to message queues. Following message queues are currently supported:"><link data-rh="true" rel="icon" href="/raccoon/favicon.ico"><link data-rh="true" rel="canonical" href="https://raystack.github.io//raccoon/concepts/architecture"><link data-rh="true" rel="alternate" href="https://raystack.github.io//raccoon/concepts/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://raystack.github.io//raccoon/concepts/architecture" hreflang="x-default"><link rel="stylesheet" href="/raccoon/assets/css/styles.9e2d6806.css">
<link rel="preload" href="/raccoon/assets/js/runtime~main.4ef048fa.js" as="script">
<link rel="preload" href="/raccoon/assets/js/main.3588fb71.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#222;color:#eee" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="announcementBarContent_xLdY">⭐️ If you like Raccoon, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/raystack/raccoon">GitHub</a>! ⭐</div><button type="button" class="clean-btn close announcementBarClose_gvF7" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/raccoon/"><div class="navbar__logo"><img src="/raccoon/logo.svg" alt="Raccoon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/raccoon/logo.svg" alt="Raccoon" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Raccoon</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/raccoon/">Documentation</a><a class="navbar__item navbar__link" href="/raccoon/support">Support</a><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link"></a><a href="https://github.com/raystack/raccoon" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-item-github"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/raccoon/"><img src="/raccoon/logo.svg" alt="Raccoon" class="themedImage_ToTc themedImage--light_HNdA"><img src="/raccoon/logo.svg" alt="Raccoon" class="themedImage_ToTc themedImage--dark_i4oU"><b>Raccoon</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/raccoon/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/raccoon/quickstart">Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/raccoon/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/raccoon/guides/overview">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/guides/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/guides/publishing">Publishing Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/guides/deployment">Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/guides/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/guides/troubleshooting">Troubleshooting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/raccoon/concepts/architecture">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/raccoon/concepts/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/concepts/structure">Structure</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/raccoon/reference/configurations">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/reference/configurations">Configurations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/reference/metrics">Metrics</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/raccoon/contribute/contribution">Contribute</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/contribute/contribution">Contribution Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/contribute/development">Development Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/raccoon/contribute/release">Release Process</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Architecture</h1><p>Raccoon written in <a href="https://github.com/golang" target="_blank" rel="noopener noreferrer">GO</a> is a high throughput, low-latency service that provides an API to ingest streaming data from mobile apps, sites and publish it to message queues. Following message queues are currently supported:</p><ul><li>Apache Kafka</li><li>Google Cloud PubSub </li><li>AWS Kinesis Data Streams</li></ul><p>Raccoon supports websocket, REST and gRPC protocols for clients to send events. With websocket it provides long persistent connections, with no overhead of additional headers sizes as in http protocol. Racoon supports protocol buffers and JSON as serialization formats. Websocket and REST API support both whereas with gRPC only protocol buffers are supported. It provides an event type agnostic API that accepts a batch <!-- -->(<!-- -->array<!-- -->)<!-- --> of events in protobuf format. Refer <a href="/raccoon/guides/publishing#data-formatters">here</a> for data definitions format that Raccoon accepts.</p><p>Raccoon was built with the primary purpose to source or collect user behaviour data in near-real time. User behaviour data is a stream of events that occur when users traverse through a mobile app or website. Raccoon powers analytics systems, big data pipelines and other disparate consumers by providing high volume, high throughput ingestion APIs consuming real time data. Raccoon’s key architecture principle is a realization of an event agnostic backend <!-- -->(<!-- -->accepts events of any type without the type awareness<!-- -->)<!-- -->. It is this capability that enables Raccoon to evolve into a strong player in the ingestion/collector ecosystem that has real time streaming/analytical needs.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="system-design">System Design<a class="hash-link" href="#system-design" title="Direct link to heading">​</a></h2><p><img loading="lazy" alt="HLD" src="/raccoon/assets/images/raccoon_hld-6627a7d982b7dd633d7214a85eacb31e.png" width="2838" height="1040" class="img_ev3q"></p><p>At a high level, the following sequence details the architecture.</p><ul><li>Raccoon accepts events through one of the supported protocols.</li><li>The events are deserialized using the correct deserializer and then forwarded to the buffered channel.</li><li>A pool of worker go routines works off the buffered channel</li><li>Each worker iterates over the events&#x27; batch, determines the topic based on the type and serializes the bytes to the Producer synchronously.</li></ul><p>Note: The internals of each of the components like channel size, buffer sizes, publisher properties etc., are configurable enabling Raccoon to be provisioned according to the system/event characteristics and load.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="connections">Connections<a class="hash-link" href="#connections" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="websockets">Websockets<a class="hash-link" href="#websockets" title="Direct link to heading">​</a></h3><p>Raccoon supports long-running persistent WebSocket connections with the client. Once a client makes an HTTP request with a WebSocket upgrade header, raccoon upgrades the HTTP request to a WebSocket connection end of which a persistent connection is established with the client.</p><p>The following sequence outlines the connection handling by Raccoon:</p><ul><li>Clients make websocket connections to Raccoon by performing a http GET API call, with headers to upgrade to websocket.</li><li>Raccoon uses <a href="https://github.com/gorilla/websocket" target="_blank" rel="noopener noreferrer">gorilla websocket</a> handlers and for each websocket connection the handlers spawn a goroutine to handle incoming requests.</li><li>After the websocket connection has been established, clients can send the events.</li><li>Construct connection identifier from the request header. The identifier is constructed from the value of <code>SERVER_WEBSOCKET_CONN_ID_HEADER</code> header. For example, Raccoon is configured with <code>SERVER_WEBSOCKET_CONN_ID_HEADER=X-User-ID</code>. Raccoon will check the value of X-User-ID header and make it an identifier. Raccoon then uses this identifier to check if there is already an existing connection with the same identifier. If the same connection already exists, Raccoon will disconnect the connection with an appropriate error message as a response proto.<ul><li>Optionally, you can also configure <code>SERVER_WEBSOCKET_CONN_GROUP_HEADER</code> to support multi-tenancy. For example, you want to use an instance of Raccoon with multiple mobile clients. You can configure raccoon with <code>SERVER_WEBSOCKET_CONN_GROUP_HEADER=X-Mobile-Client</code>. Then, Raccoon will use the value of X-Mobile-Client along with X-User-ID as identifier. The uniqueness becomes the combination of X-User-ID value with X-Mobile-Client value. This way, Raccoon can maintain the same X-User-ID within different X-Mobile-Client.</li></ul></li><li>Verify if the total connections have reached the configured limit based on <code>SERVER_WEBSOCKET_MAX_CONN</code> configuration. On reaching the max connections, Raccoon disconnects the connection with an appropriate error message as a response proto.</li><li>Upgrade the connection and persist the identifier.</li><li>Add ping/pong handlers on this connection, read timeout deadline. More about these handlers in the following sections</li><li>At this point, the connection is completely upgraded and Raccoon is ready to accept SendEventRequest. The handler handles each SendEventRequest by sending it to the events-channel. The events can be published by the publisher either synchronously or asynchronous based on the configuration.</li><li>When the connection is closed. Raccoon clean up the connection along with the identifier. The same identifier then can be reused on the upcoming connection.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rest">REST<a class="hash-link" href="#rest" title="Direct link to heading">​</a></h3><p>Client connects to the server with the same endpoint but with POST HTTP method. As it is a rest endpoint each request is uniquely handled.</p><ul><li>Connection identifier is constructed from the values of <code>SERVER_WEBSOCKET_CONN_ID_HEADER</code> and <code>SERVER_WEBSOCKET_CONN_GROUP_HEADER</code> header here too.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="grpc">gRPC<a class="hash-link" href="#grpc" title="Direct link to heading">​</a></h3><p>It is recommended to generate the gRPC client for Raccoon&#x27;s <a href="https://github.com/raystack/proton/blob/main/raystack/raccoon/EventService.proto" target="_blank" rel="noopener noreferrer">EventService</a> and use that client to do gRPC request. Currently only unary requests are supported.</p><ul><li>Client&#x27;s <code>SendEvent</code> method is called to send the event.</li><li>Connection identifier is constructed from the values of <code>SERVER_WEBSOCKET_CONN_ID_HEADER</code> and <code>SERVER_WEBSOCKET_CONN_GROUP_HEADER</code> in gRPC metadata.</li></ul><p>Clients can send the request anytime as long as the websocket connection is alive whereas with REST and gRPC requests can be sent only once.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event-delivery-gurantee-at-least-once-for-most-time">Event Delivery Gurantee <!-- -->(<!-- -->at-least-once for most time<!-- -->)<a class="hash-link" href="#event-delivery-gurantee-at-least-once-for-most-time" title="Direct link to heading">​</a></h3><p>The server for the most times provide at-least-once event delivery guarantee.</p><p>Event data loss happens in the following scenarios:</p><ul><li><p>When the server shuts down, events in-flight in the buffer or those stored in the internal channels are potentially lost. The server performs, on a best-effort basis, to send all the events within a configured shutdown timeout <code>WORKER_BUFFER_FLUSH_TIMEOUT_MS</code>. The default time is set to 5000 ms within which it is expected that all the events are sent by then.</p></li><li><p>When the downstream message queue is facing a downtime</p><p>Every event sent from the client is stored in-memory in the buffered channels <!-- -->(<!-- -->explained in the <code>Acknowledging events</code> section<!-- -->)<!-- -->. The workers pull the events from this channel and send it to Producer for publishing. The server does not maintain any event persistence. This is a conscious decision to enable a simpler, performant ingestion design for the server. In future: Server can be augmented for zero-data loss or at-least-once guarantees through intermediate event persistence.</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="acknowledging-events">Acknowledging events<a class="hash-link" href="#acknowledging-events" title="Direct link to heading">​</a></h2><p>Event acknowledgements was designed to signify if the events batch is received and sent successfully. This will enable the clients to retry on failed event delivery. Raccoon chooses when to send event acknowledgement based on the configuration parameter <code>EVENT_ACK</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event_ack--0">EVENT_ACK = 0<a class="hash-link" href="#event_ack--0" title="Direct link to heading">​</a></h3><p>Raccoon sends the acknowledgments as soon as it receives and deserializes the events successfully using the proto <code>SendEventRequest</code>. This configuration is recommended when low latency takes precedence over end to end acknowledgement. The acks are sent even before it is produced to downstream message queue. The following picture depicts the sequence of the event ack.</p><p><img loading="lazy" src="/raccoon/assets/images/raccoon_sync-3682a8af8546dae4d1ed0f7026fc1f60.png" width="4288" height="423" class="img_ev3q"></p><p>Pros:</p><ul><li>Performant as it does not wait for producer/network round trip for each batch of events.</li></ul><p>Cons:</p><ul><li>Potential data-loss and the clients do not get a chance to retry/resend the events. The possibility of data-loss occurs when the downstream message queue is experiencing downtime.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event_ack--1">EVENT_ACK = 1<a class="hash-link" href="#event_ack--1" title="Direct link to heading">​</a></h3><p>Raccoon sends the acknowledgments after the events are acknowledged successfully from the downstream message queue. This configuration is recommended when reliable end-to-end acknowledgements are required. Here the underlying publisher acknowledgement is leveraged.</p><p><img loading="lazy" src="/raccoon/assets/images/raccoon_async-293af9c9ceab1777e1780db272c51fa5.png" width="4290" height="423" class="img_ev3q"></p><p>Pros:</p><ul><li>Minimal data loss, clients can retry/resend events in case of downtime/broker failures.</li></ul><p>Cons:</p><ul><li>Increased end to end latency as clients need to wait for the event to be published.</li></ul><p>Considering that kafka is set up in a clustered, cross-region, cross-zone environment, the chances of it going down are  unlikely. In case if it does, the amount of events lost is negligible considering it is a streaming system and is expected to forward millions of events/sec.</p><p>PubSub and Kinesis offer strong SLAs (&gt;=99.95% and &gt;=99.9%) so they are least likey to be unavailable. However, you may hit rate limits for these services, so we advise that you provision your infrastructure sufficiently to avoid it. In case a rate-limit is hit, Raccoon will report the message as undelivered.</p><p>When an SendEventRequest is sent to Raccoon over any connection be it Websocket/HTTP/gRPC a corresponding response is sent by the server indicating whether the event was consumed successfully or not.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="supported-protocols-and-data-formats">Supported Protocols and Data formats<a class="hash-link" href="#supported-protocols-and-data-formats" title="Direct link to heading">​</a></h2><table><thead><tr><th align="center">Protocol</th><th align="center">Data Format</th><th align="center">Version</th></tr></thead><tbody><tr><td align="center">WebSocket</td><td align="center">Protobufs</td><td align="center">v0.1.0</td></tr><tr><td align="center">WebSocket</td><td align="center">JSON</td><td align="center">v0.1.2</td></tr><tr><td align="center">REST API</td><td align="center">JSON</td><td align="center">v0.1.2</td></tr><tr><td align="center">REST API</td><td align="center">Protobufs</td><td align="center">v0.1.2</td></tr><tr><td align="center">gRPC</td><td align="center">Protobufs</td><td align="center">v0.1.2</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="request-and-response-models">Request and Response Models<a class="hash-link" href="#request-and-response-models" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="protobufs">Protobufs<a class="hash-link" href="#protobufs" title="Direct link to heading">​</a></h3><p>When an <a href="https://github.com/raystack/proton/blob/main/raystack/raccoon/v1beta1/raccoon.proto" target="_blank" rel="noopener noreferrer">SendEventRequest</a> proto below containing events are sent over the wire</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">SendEventRequest</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//unique guid generated by the client for this request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> req_guid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// time probably when the client sent it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">google</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">protobuf</span><span class="token positional-class-name class-name punctuation" style="color:#393A34">.</span><span class="token positional-class-name class-name">Timestamp</span><span class="token plain"> sent_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// actual events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">repeated</span><span class="token plain"> </span><span class="token positional-class-name class-name">Event</span><span class="token plain"> events </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>a corresponding <a href="https://github.com/raystack/proton/blob/main/raystack/raccoon/v1beta1/raccoon.proto" target="_blank" rel="noopener noreferrer">SendEventResponse</a> is sent by the server.</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">SendEventResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">Status</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token positional-class-name class-name">Code</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/* time when the response is generated */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">int64</span><span class="token plain"> sent_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/* failure reasons if any */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> reason </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/* Usually detailing the success/failures */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token map class-name">map</span><span class="token map class-name punctuation" style="color:#393A34">&lt;</span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">,</span><span class="token map class-name"> </span><span class="token map class-name builtin">string</span><span class="token map class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="json">JSON<a class="hash-link" href="#json" title="Direct link to heading">​</a></h3><p>When a JSON event like the one mentioned below is sent a corresponding JSON response is sent by the server.</p><p><strong>Request</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;req_guid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1234abcd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sent_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;seconds&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1638154927</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;nanos&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">376499000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;events&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;eventBytes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Cg4KCHNlcnZpY2UxEgJBMRACIAEyiQEKJDczZTU3ZDlhLTAzMjQtNDI3Yy1hYTc5LWE4MzJjMWZkY2U5ZiISCcix9QzhsChAEekGEi1cMlNAKgwKAmlkEgJpZBjazUsyFwoDaU9zEgQxMi4zGgVBcHBsZSIDaTEwOiYKJDczZTU3ZDlhLTAzMjQtNDI3Yy1hYTc5LWE4MzJjMWZkY2U5Zg==&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;booking&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Response</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;sent_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1638155915</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;req_guid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1234abcd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event-distribution">Event Distribution<a class="hash-link" href="#event-distribution" title="Direct link to heading">​</a></h3><p>Event distribution works by finding the type for each event in the batch and sending them to appropriate message queue topic. The topic name is determined by the following code</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">topic </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> strings</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">topicFormat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where:</p><ul><li><strong>topicFormat</strong> - is the pattern configured via <code>EVENT_DISTRIBUTION_PUBLISHER_PATTERN</code> </li><li><strong>type</strong> - is the type set by the client on the Event</li></ul><p>For eg. setting the</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">EVENT_DISTRIBUTION_PUBLISHER_PATTERN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">topic-%s-log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and a type such as <code>type=viewed</code> in the <a href="https://github.com/raystack/proton/blob/main/raystack/raccoon/v1beta1/raccoon.proto" target="_blank" rel="noopener noreferrer">event</a> format</p><div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">message</span><span class="token plain"> </span><span class="token class-name">Event</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  `eventBytes` is where you put bytes serialized event.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">bytes</span><span class="token plain"> eventBytes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  `type` denotes an event type that the producer of this proto message may set.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  It is currently used by raccoon to distribute events to respective message queue topics. However the</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  users of this proto can use this type to set strings which can be processed in their</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  ingestion systems to distribute or perform other functions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">string</span><span class="token plain"> type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>will have the event sent to a topic like</p><p><code>topic-viewed-log</code></p><p>The event distribution does not depend on any partition logic. So events can be randomly distributed to any available partition.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="event-deserialization">Event Deserialization<a class="hash-link" href="#event-deserialization" title="Direct link to heading">​</a></h3><p>The top level wrapper <code>SendEventRequest</code> is deserialized which provides a list of events of type <code>Event</code> proto. This event wrapper composes of serialized bytes, which is the actual event, set in the field <code>bytes</code> inside the <code>Event</code> proto. Raccoon does not open this underlying bytes. The deserialization is used to unwrap the event type and determine the topic that the <code>eventBytes</code> <!-- -->(<!-- -->an event<!-- -->)<!-- --> need to be sent to.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="channels">Channels<a class="hash-link" href="#channels" title="Direct link to heading">​</a></h3><p>Buffered Channels are used to store the incoming events&#x27; batch. The channel sizes can be configured based on the load &amp; capacity.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="keeping-connections-alive">Keeping connections alive<a class="hash-link" href="#keeping-connections-alive" title="Direct link to heading">​</a></h3><p>The server ensures that the connections are recyclable. It adopts mechanisms to check connection time idleness. The handlers ping clients very 30 seconds <!-- -->(<!-- -->configurable<!-- -->)<!-- -->. If the client does not respond within a stipulated time the connection is marked as corrupt. Every subsequent read/write message there after on this connection fails. Raccoon removes the connections post this. Clients can also ping the server while the server responds with pongs to these pings. Clients can programmatically reconnect on failed or corrupt server connections.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="components">Components<a class="hash-link" href="#components" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="producer">Producer<a class="hash-link" href="#producer" title="Direct link to heading">​</a></h3><p>Raccoon supports a number of destination event storage systems. Following is a list of currently supported systems, along with their status. </p><table><thead><tr><th>Name</th><th>Version</th><th>Status</th></tr></thead><tbody><tr><td>Apache Kafka</td><td>v0.1.0</td><td><code>STABLE</code></td></tr><tr><td>Google Cloud PubSub</td><td>v0.2.3</td><td><code>ALPHA</code></td></tr><tr><td>AWS Kinesis Data Streams</td><td>v0.2.5</td><td><code>ALPHA</code></td></tr></tbody></table><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="apache-kafka">Apache Kafka<a class="hash-link" href="#apache-kafka" title="Direct link to heading">​</a></h4><p>Raccoon uses <a href="https://github.com/confluentinc/confluent-kafka-go" target="_blank" rel="noopener noreferrer">confluent go kafka</a> as the producer client to publish events. Publishing events are light weight and relies on kafka producer&#x27;s retries. Confluent internally uses librdkafka which produces events asynchronously. Application writes messages using a functional based producer API</p><p><code>Produce(message, deliveryChannel)</code> -- <code>deliveryChannel</code> is where the delivery reports or acknowledgements are received.</p><p>Raccoon internally checks for these delivery reports before pulling the next batch of events. On failed deliveries the appropriate metrics are updated. This mechanism makes the events delivery synchronous and a reliable events delivery.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="google-cloud-pubsub">Google Cloud PubSub<a class="hash-link" href="#google-cloud-pubsub" title="Direct link to heading">​</a></h4><p>Raccoon uses <a href="https://pkg.go.dev/cloud.google.com/go/pubsub" target="_blank" rel="noopener noreferrer">cloud.google.com/go/pubsub</a> as the producer client for publishing events to Google Cloud PubSub.</p><p>The Google Cloud PubSub SDK internally buffers messages in batches before sending them downstream. You can control this buffering behaviour by tuning the following env variables:</p><ul><li><a href="/raccoon/reference/configurations#publisher_pubsub_publish_count_threshold"><code>PUBLISHER_PUBSUB_PUBLISH_COUNT_THRESHOLD</code></a></li><li><a href="/raccoon/reference/configurations#publisher_pubsub_publish_byte_threshold"><code>PUBLISHER_PUBSUB_PUBLISH_BYTE_THRESHOLD</code></a></li><li><a href="/raccoon/reference/configurations#publisher_pubsub_publish_delay_threshold_ms"><code>PUBLISHER_PUBSUB_PUBLISH_DELAY_THRESHOLD_MS</code></a></li></ul><p>The defaults for these settings are optimal for near-realtime uses cases.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="aws-kinesis-data-streams">AWS Kinesis Data Streams<a class="hash-link" href="#aws-kinesis-data-streams" title="Direct link to heading">​</a></h4><p>Raccoon uses <a href="https://pkg.go.dev/github.com/aws/aws-sdk-go-v2/service/kinesis" target="_blank" rel="noopener noreferrer">github.com/aws/aws-sdk-go-v2/service/kinesis</a> as the producer client for publishing events to AWS Kinesis.</p><p>In particular, <code>kinesis.PutRecord()</code> is used for sending messages downstream. This means that the messages are sent immediately without any buffering at the SDK level. Each message is given a random partition key (using <code>rand.Int31()</code>) so that messages are evenly distributed amongst available shards. </p><p>In the future, Raccoon may support a more robust partition selection mechanism that has stronger distribution guarantees.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="observability-stack">Observability Stack<a class="hash-link" href="#observability-stack" title="Direct link to heading">​</a></h3><p>Raccoon supports <a href="https://github.com/statsd/statsd" target="_blank" rel="noopener noreferrer">StatsD</a> and <a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus</a> as telemetry systems.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="statd"><a href="https://github.com/statsd/statsd" target="_blank" rel="noopener noreferrer">StatD</a><a class="hash-link" href="#statd" title="Direct link to heading">​</a></h4><p>A recommended choice for observability stack would be to host <a href="https://www.influxdata.com/time-series-platform/telegraf/" target="_blank" rel="noopener noreferrer">telegraf</a> as the receiver of these measurements and export it to <a href="https://www.influxdata.com/get-influxdb/" target="_blank" rel="noopener noreferrer">influx</a> database for storage, <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">grafana</a> to build dashboards using Influx as the source.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="prometheus"><a href="https://prometheus.io/" target="_blank" rel="noopener noreferrer">Prometheus</a><a class="hash-link" href="#prometheus" title="Direct link to heading">​</a></h4><p>Prometheus operates on a pull model and comes with it&#x27;s own time-series database. You don&#x27;t need any additional components apart from the prometheus to start collecting and storing metrics. <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana</a> can be used to build dashboards using Prometheus as a data source.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/raystack/raccoon/edit/master/docs/docs/concepts/architecture.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/raccoon/guides/troubleshooting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshooting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/raccoon/concepts/structure"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Structure</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-design" class="table-of-contents__link toc-highlight">System Design</a></li><li><a href="#connections" class="table-of-contents__link toc-highlight">Connections</a><ul><li><a href="#websockets" class="table-of-contents__link toc-highlight">Websockets</a></li><li><a href="#rest" class="table-of-contents__link toc-highlight">REST</a></li><li><a href="#grpc" class="table-of-contents__link toc-highlight">gRPC</a></li><li><a href="#event-delivery-gurantee-at-least-once-for-most-time" class="table-of-contents__link toc-highlight">Event Delivery Gurantee (at-least-once for most time)</a></li></ul></li><li><a href="#acknowledging-events" class="table-of-contents__link toc-highlight">Acknowledging events</a><ul><li><a href="#event_ack--0" class="table-of-contents__link toc-highlight">EVENT_ACK = 0</a></li><li><a href="#event_ack--1" class="table-of-contents__link toc-highlight">EVENT_ACK = 1</a></li></ul></li><li><a href="#supported-protocols-and-data-formats" class="table-of-contents__link toc-highlight">Supported Protocols and Data formats</a></li><li><a href="#request-and-response-models" class="table-of-contents__link toc-highlight">Request and Response Models</a><ul><li><a href="#protobufs" class="table-of-contents__link toc-highlight">Protobufs</a></li><li><a href="#json" class="table-of-contents__link toc-highlight">JSON</a></li><li><a href="#event-distribution" class="table-of-contents__link toc-highlight">Event Distribution</a></li><li><a href="#event-deserialization" class="table-of-contents__link toc-highlight">Event Deserialization</a></li><li><a href="#channels" class="table-of-contents__link toc-highlight">Channels</a></li><li><a href="#keeping-connections-alive" class="table-of-contents__link toc-highlight">Keeping connections alive</a></li></ul></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a><ul><li><a href="#producer" class="table-of-contents__link toc-highlight">Producer</a><ul><li><a href="#apache-kafka" class="table-of-contents__link toc-highlight">Apache Kafka</a></li><li><a href="#google-cloud-pubsub" class="table-of-contents__link toc-highlight">Google Cloud PubSub</a></li><li><a href="#aws-kinesis-data-streams" class="table-of-contents__link toc-highlight">AWS Kinesis Data Streams</a></li></ul></li><li><a href="#observability-stack" class="table-of-contents__link toc-highlight">Observability Stack</a><ul><li><a href="#statd" class="table-of-contents__link toc-highlight">StatD</a></li><li><a href="#prometheus" class="table-of-contents__link toc-highlight">Prometheus</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"></div></footer></div>
<script src="/raccoon/assets/js/runtime~main.4ef048fa.js"></script>
<script src="/raccoon/assets/js/main.3588fb71.js"></script>
</body>
</html>