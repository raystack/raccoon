"use strict";(self.webpackChunkraccoon=self.webpackChunkraccoon||[]).push([[226],{5680:(e,t,a)=>{a.d(t,{xA:()=>u,yg:()=>g});var n=a(6540);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),c=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(i.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(a),d=r,g=p["".concat(i,".").concat(d)]||p[d]||m[d]||o;return a?n.createElement(g,s(s({ref:t},u),{},{components:a})):n.createElement(g,s({ref:t},u))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[p]="string"==typeof e?e:r,s[1]=l;for(var c=2;c<o;c++)s[c]=a[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9365:(e,t,a)=>{a.d(t,{A:()=>s});var n=a(6540),r=a(53);const o={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:a,className:s}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.A)(o.tabItem,s),hidden:a},t)}},4865:(e,t,a)=>{a.d(t,{A:()=>m});var n=a(8168),r=a(6540),o=a(53),s=a(2303),l=a(1682),i=a(4595),c=a(3104);const u={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function p(e){var t;const{lazy:a,block:s,defaultValue:p,values:m,groupId:d,className:g}=e,h=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=m??h.map((e=>{let{props:{value:t,label:a,attributes:n}}=e;return{value:t,label:a,attributes:n}})),y=(0,l.X)(f,((e,t)=>e.value===t.value));if(y.length>0)throw new Error(`Docusaurus error: Duplicate values "${y.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const b=null===p?p:p??(null==(t=h.find((e=>e.props.default)))?void 0:t.props.value)??h[0].props.value;if(null!==b&&!f.some((e=>e.value===b)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${b}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:_}=(0,i.x)(),[w,N]=(0,r.useState)(b),T=[],{blockElementScrollPositionUntilNextRender:x}=(0,c.a_)();if(null!=d){const e=v[d];null!=e&&e!==w&&f.some((t=>t.value===e))&&N(e)}const E=e=>{const t=e.currentTarget,a=T.indexOf(t),n=f[a].value;n!==w&&(x(t),N(n),null!=d&&_(d,String(n)))},k=e=>{var t;let a=null;switch(e.key){case"ArrowRight":{const t=T.indexOf(e.currentTarget)+1;a=T[t]??T[0];break}case"ArrowLeft":{const t=T.indexOf(e.currentTarget)-1;a=T[t]??T[T.length-1];break}}null==(t=a)||t.focus()};return r.createElement("div",{className:(0,o.A)("tabs-container",u.tabList)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":s},g)},f.map((e=>{let{value:t,label:a,attributes:s}=e;return r.createElement("li",(0,n.A)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>T.push(e),onKeyDown:k,onFocus:E,onClick:E},s,{className:(0,o.A)("tabs__item",u.tabItem,null==s?void 0:s.className,{"tabs__item--active":w===t})}),a??t)}))),a?(0,r.cloneElement)(h.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function m(e){const t=(0,s.A)();return r.createElement(p,(0,n.A)({key:String(t)},e))}},9358:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>g,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var n=a(8168),r=(a(6540),a(5680)),o=a(4865),s=a(9365);const l={},i="Monitoring",c={unversionedId:"guides/monitoring",id:"guides/monitoring",title:"Monitoring",description:"Raccoon provides monitoring for server connection, publisher, resource usage, and event delivery. Reference for available metrics is available here. The metrics are reported using Statsd and Prometheus",source:"@site/docs/guides/monitoring.md",sourceDirName:"guides",slug:"/guides/monitoring",permalink:"/raccoon/guides/monitoring",draft:!1,editUrl:"https://github.com/raystack/raccoon/edit/master/docs/docs/guides/monitoring.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Deployment",permalink:"/raccoon/guides/deployment"},next:{title:"Troubleshooting",permalink:"/raccoon/guides/troubleshooting"}},u={},p=[{value:"How To Setup",id:"how-to-setup",level:2},{value:"Metrics Usages",id:"metrics-usages",level:2},{value:"Data Loss",id:"data-loss",level:3},{value:"Latency",id:"latency",level:3},{value:"Dashboard",id:"dashboard",level:3}],m={toc:p},d="wrapper";function g(e){let{components:t,...a}=e;return(0,r.yg)(d,(0,n.A)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"monitoring"},"Monitoring"),(0,r.yg)("p",null,"Raccoon provides monitoring for server connection, publisher, resource usage, and event delivery. Reference for available metrics is available ",(0,r.yg)("a",{parentName:"p",href:"/raccoon/reference/metrics"},"here"),". The metrics are reported using ",(0,r.yg)("a",{parentName:"p",href:"https://www.datadoghq.com/blog/statsd/"},"Statsd")," and ",(0,r.yg)("a",{parentName:"p",href:"https://prometheus.io/"},"Prometheus")),(0,r.yg)("h2",{id:"how-to-setup"},"How To Setup"),(0,r.yg)(o.A,{mdxType:"Tabs"},(0,r.yg)(s.A,{value:"statsd",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-text"},"TL;DR\n- Run Statsd supported metric collector\n- Configure `METRIC_STATSD_ADDRESS` on Raccoon to send to the metric collector\n- Visualize and create alerting from the collected metrics\n")),(0,r.yg)("p",null,"Generally, you can follow the steps above and use any metric collector that supports statsd like ",(0,r.yg)("a",{parentName:"p",href:"https://www.influxdata.com/blog/getting-started-with-sending-statsd-metrics-to-telegraf-influxdb/"},"Telegraf")," or ",(0,r.yg)("a",{parentName:"p",href:"https://docs.datadoghq.com/developers/dogstatsd/?tab=hostagent"},"Datadog"),"."),(0,r.yg)("p",null,"This section will cover a setup example using ",(0,r.yg)("a",{parentName:"p",href:"https://www.influxdata.com/time-series-platform/telegraf/"},"Telegraf"),", ",(0,r.yg)("a",{parentName:"p",href:"https://www.influxdata.com/"},"Influx"),", ",(0,r.yg)("a",{parentName:"p",href:"https://www.influxdata.com/time-series-platform/kapacitor/"},"Kapacitor"),", and ",(0,r.yg)("a",{parentName:"p",href:"https://grafana.com/"},"Grafana")," stack based on the steps above."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Run Statsd Supported Metric Collector")," To enable statsd on Telegraf you need to enable statsd input on ",(0,r.yg)("inlineCode",{parentName:"p"},"telegraf.conf")," file. Following are default configurations that you can add based on statsd input ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/influxdata/telegraf/blob/master/plugins/inputs/statsd/README.md"},"readme"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-toml"},'[[inputs.statsd]]\n  protocol = "udp"\n  max_tcp_connections = 250\n  tcp_keep_alive = false\n  service_address = ":8125"\n\n  delete_gauges = true\n  delete_counters = true\n  delete_sets = true\n  delete_timings = true\n\n  percentiles = [50.0, 90.0, 99.0, 99.9, 99.95, 100.0]\n\n  metric_separator = "_"\n\n  parse_data_dog_tags = false\n  datadog_extensions = false\n  datadog_distributions = false\n\n  allowed_pending_messages = 10000\n  percentile_limit = 1000\n\n[[outputs.influxdb]]\n  urls = ["http://127.0.0.1:8086"]\n  database = "raccoon"\n  retention_policy = "autogen"\n  write_consistency = "any"\n  timeout = "5s"\n')),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Configure Raccoon To Send To The Metric Collector")," After you have the collector with the port configured, you need to set ",(0,r.yg)("a",{parentName:"p",href:"/raccoon/reference/configurations#metric_statsd_address"},"METRIC_STATSD_ADDRESS")," to match the metric collector address. Suppose you deploy the telegraf using the default configuration above as sidecar or in localhost, you need to set the value to ",(0,r.yg)("inlineCode",{parentName:"p"},":8125"),"."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Visualize And Create Alerting From The Collected Metrics")," Now that you have Raccoon and Telegraf as metric collector set, next is to use the metrics reported. You may notice that the Telegraf config above contains ",(0,r.yg)("inlineCode",{parentName:"p"},"outputs.influxdb"),". That config will send the metric received to Influxdb. Make sure you have influx service accessible from the configured URL. You can visualize the metrics using Grafana. To do that, you need to ",(0,r.yg)("a",{parentName:"p",href:"https://www.influxdata.com/blog/how-grafana-dashboard-influxdb-flux-influxql/"},"add influx datasource")," to make the data available on Grafana. After that, you can use the data to You can ",(0,r.yg)("a",{parentName:"p",href:"https://grafana.com/docs/grafana/latest/datasources/influxdb/#influxql-query-editor"},"visualize the metrics")," using Grafana. ")),(0,r.yg)(s.A,{value:"prometheus",mdxType:"TabItem"},(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-text"},"TL;DR\n- Run Prometheus\n- Configure `METRIC_PROMETHEUS_PORT` and `METRIC_PROMETHEUS_ENABLED` on Raccoon\n- Visualize and create alerting from the collected metrics\n")),(0,r.yg)("p",null,"Setting up ",(0,r.yg)("a",{parentName:"p",href:"https://prometheus.io"},"Prometheus")," is fairly straight-forward. Prometheus is available as a self-contained binary program for most platforms.\nFor alerting you can use ",(0,r.yg)("a",{parentName:"p",href:"https://prometheus.io/docs/alerting/latest/alertmanager/"},"alertmanager")," that let's you define alerts and offers integration with different notification platforms. For visualisation ",(0,r.yg)("a",{parentName:"p",href:"https://grafana.com/"},"Grafana")," comes with out-of-the-box support for prometheus as a data source."),(0,r.yg)("p",null,"You can download prometheus from their ",(0,r.yg)("a",{parentName:"p",href:"https://prometheus.io/download/"},"official website"),"."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Run Prometheus")),(0,r.yg)("p",null,"Let's explore an example setup that runs prometheus locally. Begin by creating a new directory and downloading prometheus."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ mkdir prometheus-for-raccoon\n$ cd prometheus-for-raccoon\n$ wget https://github.com/prometheus/prometheus/releases/download/v2.53.1/prometheus-2.53.1.linux-amd64.tar.gz\n$ tar xzvf prometheus-2.53.1.linux-amd64.tar.gz\n$ cd prometheus-2.53.1.linux-amd64\n")),(0,r.yg)("p",null,"Next, we will edit ",(0,r.yg)("inlineCode",{parentName:"p"},"prometheus.yml")," to tell prometheus to scrape metrics from raccoon. You can use any text editor that you're familiar with."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml",metastring:"title=prometheus.yml",title:"prometheus.yml"},'global:\n  scrape_interval: 15s \n  evaluation_interval: 15s \n\nscrape_configs:\n  - job_name: "raccoon"\n    static_configs:\n      - targets: ["localhost:8888"]\n\n')),(0,r.yg)("p",null,"Now run prometheus "),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"$ ./prometheus --config.file=./prometheus.yml\n")),(0,r.yg)("p",null,"We have now configured prometheus to scrape metrics from ",(0,r.yg)("inlineCode",{parentName:"p"},"localhost:8888"),". We will now tell raccoon to expose prometheus metric on this port."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Configure ",(0,r.yg)("inlineCode",{parentName:"strong"},"METRIC_PROMETHEUS_PORT")," and ",(0,r.yg)("inlineCode",{parentName:"strong"},"METRIC_PROMETHEUS_ENABLED")," on Raccoon")),(0,r.yg)("p",null,"By default, raccoon doesn't expose prometheus metrics. To enable prometheus metrics, you need to set the following environment variables:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"METRIC_PROMETHEUS_ENABLED=true\nMETRIC_PROMETHEUS_PORT=8888   \n")),(0,r.yg)("p",null,"Now when you run raccoon, prometheus will start collecting metrics from it."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Visualize And Create Alerting From The Collected Metrics")," "),(0,r.yg)("p",null,"Now that you have Raccoon and Prometheus setup, next is to use the metrics reported. You can visualize the metrics using Grafana. To do that, you need to ",(0,r.yg)("a",{parentName:"p",href:"https://grafana.com/docs/grafana/latest/datasources/prometheus/"},"add prometheus datasource")," to make the data available on Grafana. After that, you can use the data to visualize the metrics using Grafana. "))),(0,r.yg)("h2",{id:"metrics-usages"},"Metrics Usages"),(0,r.yg)("p",null,"Following are key monitoring statistics that you can infer from Raccoon metrics. Refer to this section to understand how to build alerting, dashboard, or analyze the metrics."),(0,r.yg)("h3",{id:"data-loss"},"Data Loss"),(0,r.yg)("p",null,"To infer data loss, you can count ",(0,r.yg)("a",{parentName:"p",href:"/raccoon/reference/metrics#kafka_messages_delivered_total"},(0,r.yg)("inlineCode",{parentName:"a"},"kafka_messages_delivered_total"))," with tag ",(0,r.yg)("inlineCode",{parentName:"p"},"success=false"),". You can also infer the loss rate by calculating the following."),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"count(kafka_messages_delivered_total success=false)/count(kafka_messages_delivered_total)")),(0,r.yg)("p",null,"For other publishers, just replace ",(0,r.yg)("inlineCode",{parentName:"p"},"kafka")," in the metric name with the name of the publisher. For instance, analogs of ",(0,r.yg)("inlineCode",{parentName:"p"},"kafka_messages_delivered_total")," for PubSub and Kinesis would be:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/raccoon/reference/metrics#pubsub_messages_delivered_total"},(0,r.yg)("inlineCode",{parentName:"a"},"pubsub_messages_delivered_total"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/raccoon/reference/metrics#kinesis_messages_delivered_total"},(0,r.yg)("inlineCode",{parentName:"a"},"kinesis_messages_delivered_total")))),(0,r.yg)("h3",{id:"latency"},"Latency"),(0,r.yg)("p",null,"Raccoon provides fine-grained metrics that denote latency. That gives clues as to where to look in case something goes wrong. In summary, these are key metrics for latency:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/raccoon/reference/metrics#event_processing_duration_milliseconds"},(0,r.yg)("inlineCode",{parentName:"a"},"event_processing_duration_milliseconds"))," This metrics denotes overall latency. You need to look at other latency metrics to find the root cause when this metric is high."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/raccoon/reference/metrics#server_processing_latency_milliseconds"},(0,r.yg)("inlineCode",{parentName:"a"},"server_processing_latency_milliseconds"))," Correlate this metric with ",(0,r.yg)("inlineCode",{parentName:"li"},"event_processing_duration_milliseconds")," to infer whether the issue is with Raccoon itself, or something wrong with the network, or the way ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/raystack/proton/blob/main/raystack/raccoon/v1beta1/raccoon.proto#L47"},"sent_time")," is generated.-"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/raccoon/reference/metrics#worker_processing_duration_milliseconds"},(0,r.yg)("inlineCode",{parentName:"a"},"worker_processing_duration_milliseconds"))," High value of this metric indicates that the publisher is slow or can't keep up.")),(0,r.yg)("h3",{id:"dashboard"},"Dashboard"),(0,r.yg)("p",null,"There is a pre-built ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/raystack/raccoon/blob/main/grafana.json"},"grafana dashboard")," available with support for Prometheus data source."),(0,r.yg)("p",null,"If you're running the statsd + telegraf setup, you can configure telegraf to push metrics to Prometheus."))}g.isMDXComponent=!0}}]);